!function(e,t){"function"==typeof define&&define.amd?define(["event-dispatcher","deferred-data-access"],t):"object"==typeof module&&module.exports?module.exports=t(require("event-dispatcher"),require("deferred-data-access")):e.RESTObject=t(e.EventDispatcher,e.DataAccessInterface)}(this,function(e,t){function n(){this.id="Fake/ResourcePool",this.set=function(e){return e},this.has=function(){return!1},this.get=function(e){return e},this.remove=function(){},this.clear=function(){},this.isActive=function(){return!0},this.destroy=function(){},this.addEventListener=function(){},this.hasEventListener=function(){},this.removeEventListener=function(){}}function r(){var e=new n;this.createPool=function(){return e},this.register=function(){},this.get=function(t){return e.id===t?e:null},this.isRegistered=function(t){return t instanceof j?e===t:e.id===t},this.remove=function(){},this.addEventListener=function(){},this.hasEventListener=function(){},this.removeEventListener=function(){}}function c(e,t){var n="",r=e.match(/([^\/\\]+)(?:\/|\\)*/g)||[];if("/"===t.charAt())n+=t;else if("../"===t.substr(0,3)){for(var c=t.match(/([^\/\\]+)(?:\/|\\)+/g);c.length&&r.length&&"../"===c[0];)c.shift(),r.pop();t=c.join("")+t.match(/[^\/\\]*$/g)[0],n+="/"+r.join("")}else"./"===t.substr(0,2)?(t=t.substring(2),n+="/"+r.join("")):n+="/"+r.join("");return n+"/"+t}function u(e,n){var r=A.get(t.getResourceId(e)),u=r.resource;return c(u,n)}function o(e,t){return A.set(u(e,t)).toJSON()}function i(e,t,n){n.resolve(o(e,t.cmd))}function s(e,t,n){n.resolve(O.toJSON(e))}function a(e,n,r,c){var u=A.get(t.getResourceId(n)),o=u.resource;e(y.CREATE,o,r.cmd,r.value,c)}function f(e,n,r,c){var u=A.get(t.getResourceId(n)),o=u.resource;e(y.READ,o,r.cmd,r.value,c)}function d(e,n,r,c){var u=A.get(t.getResourceId(n)),o=u.resource;e(y.UPDATE,o,r.cmd,r.value,c)}function l(e,n,r,c){var u=A.get(t.getResourceId(n)),o=u.resource;e(y.DELETE,o,r.cmd,r.value,c)}function E(e,t,n,r,c){if(O.getQueueLength(c))i(t,n,r);else{var o=u(t,n.cmd);e(y.READ,o,n.value,null,r)}}function h(e,t,n,r){var c=u(t,n.cmd);e(y.UPDATE,c,n.value,null,r)}function v(e,n,r,c){var u=A.get(t.getResourceId(n)),o=u.resource,i=r.value.length;1===i&&e(y.CREATE,o,r.value[0],null,c)}function T(e,t,n,r){var c=u(t,n.cmd);e(y.DELETE,c,n.value,null,r)}function g(e){function t(t,n,r,c){setTimeout(e,0,t,n,r,c)}return t}function p(e,t,n,r,c){r&&(t+=(t.indexOf("?")<0?"?":"&")+jQuery.param(r)),jQuery.ajax({method:RESTObject.HTTPMethods[e],url:t,data:n?JSON.stringify(n):null,dataType:"json",contentType:"application/json; charset=utf-8",success:function(e){c.resolve(e)},error:function(e){c.reject(e)}})}function R(e,n,c){n=n||RESTObject.FETCH;var u=[b.create(y.CREATE,a.bind(null,n)),b.create(y.READ,f.bind(null,n)),b.create(y.UPDATE,d.bind(null,n)),b.create(y.DELETE,l.bind(null,n)),b.create(y.ROUTE,i),b.create(y.PREVENT_DEFAULT,s)];D.createDescriptors({get:g(E.bind(null,n)),set:h.bind(null,n),apply:v.bind(null,n),deleteProperty:T.bind(null,n)},null,u);var o=t.create(u,c!==!1,new r,null),p=A.set(e||"string"==typeof e?e:"/");return o.parse(p.toJSON())}function m(e){for(var t;t=O.getLastChild(e);)e=t;return e}var j=t.ResourcePool,b=t.CommandDescriptor,D=t.ProxyCommands,O=t.RequestTarget;j.setValidTargets(j.getDefaultValidTargets().concat(["string"]));var A=j.create(),y=Object.freeze({CREATE:"create",READ:"read",UPDATE:"update",DELETE:"delete",ROUTE:"route",PREVENT_DEFAULT:"preventDefault"}),P=Object.freeze({create:"PUT",read:"GET",update:"POST","delete":"DELETE"}),L=function(){function e(e,t){return e+(e.indexOf("?")<0?"?":"&")+Object.keys(t).reduce(function(e,n){return e.push(encodeURIComponent(n)+"="+encodeURIComponent(t[n])),e},[]).join("&")}function t(t,r,c,u,o){n||(n=new Headers,n.append("Content-Type","application/json; charset=utf-8"));var i={method:RESTObject.HTTPMethods[t]};u&&(r=e(r,u)),c&&(i.headers=n,i.body=JSON.stringify(c)),fetch(r,i).then(function(e){o.resolve(e.json())},function(e){o.reject(e)})}var n;return t}();return RESTObject=Object.freeze({create:R,JQUERY:p,FETCH:L,Commands:y,HTTPMethods:P,DataAccessInterface:t,RequestTarget:O,getDeepestChild:m}),RESTObject});