!function(e,t){"function"==typeof define&&define.amd?define(["event-dispatcher","deferred-data-access"],t):"object"==typeof module&&module.exports?module.exports=t(require("event-dispatcher"),require("deferred-data-access")):e.RESTObject=t(e.EventDispatcher,e.DataAccessInterface)}(this,function(e,t){function n(){this.id="Fake/ResourcePool",this.set=function(e){return e},this.has=function(){return!1},this.get=function(e){return e},this.remove=function(){},this.clear=function(){},this.isActive=function(){return!0},this.destroy=function(){},this.addEventListener=function(){},this.hasEventListener=function(){},this.removeEventListener=function(){}}function r(){var e=new n;this.createPool=function(){return e},this.register=function(){},this.get=function(t){return e.id===t?e:null},this.isRegistered=function(t){return t instanceof m?e===t:e.id===t},this.remove=function(){},this.addEventListener=function(){},this.hasEventListener=function(){},this.removeEventListener=function(){}}function c(e,t){var n="",r=e.match(/([^\/\\]+)(?:\/|\\)*/g)||[];if("/"===t.charAt())n+=t;else if("../"===t.substr(0,3)){for(var c=t.match(/([^\/\\]+)(?:\/|\\)+/g);c.length&&r.length&&"../"===c[0];)c.shift(),r.pop();t=c.join("")+t.match(/[^\/\\]*$/g)[0],n+="/"+r.join("")}else"./"===t.substr(0,2)?(t=t.substring(2),n+="/"+r.join("")):n+="/"+r.join("");return n+"/"+t}function o(e,n){var r=A.get(t.getResourceId(e)),o=r.resource;return c(o,n)}function i(e,t){return A.set(o(e,t)).toJSON()}function u(e,t,n){n.resolve(i(e,t.cmd))}function s(e,t,n){n.resolve(b.toJSON(e))}function a(e,n,r,c){var o=A.get(t.getResourceId(n)),i=o.resource;e(O.CREATE,i,r.cmd,c)}function f(e,n,r,c){var o=A.get(t.getResourceId(n)),i=o.resource;e(O.READ,i,r.cmd,c)}function d(e,n,r,c){var o=A.get(t.getResourceId(n)),i=o.resource;e(O.UPDATE,i,r.cmd,c)}function E(e,n,r,c){var o=A.get(t.getResourceId(n)),i=o.resource;e(O.DELETE,i,r.cmd,c)}function l(e,t,n,r,c){if(b.getQueueLength(c))u(t,n,r);else{var i=o(t,n.cmd);e(O.READ,i,n.value,r)}}function h(e,t,n,r){var c=o(t,n.cmd);e(O.UPDATE,c,n.value,r)}function T(e,n,r,c){var o=A.get(t.getResourceId(n)),i=o.resource;1===r.value.length&&e(O.CREATE,i,r.value[0],c)}function v(e,t,n,r){var c=o(t,n.cmd);e(O.DELETE,c,n.value,r)}function g(e){function t(t,n,r,c){setTimeout(e,0,t,n,r,c)}return t}function R(e,t,n,r){jQuery.ajax({method:RESTObject.HTTPMethods[e],url:t,data:e===O.READ?n:JSON.stringify(n),dataType:"json",contentType:"application/json; charset=utf-8",success:function(e){r.resolve(e)},error:function(e){r.reject(e)}})}function p(e,n){n=n||RESTObject.FETCH;var c=[j.create(O.CREATE,a.bind(null,n)),j.create(O.READ,f.bind(null,n)),j.create(O.UPDATE,d.bind(null,n)),j.create(O.DELETE,E.bind(null,n)),j.create(O.ROUTE,u),j.create(O.PREVENT_DEFAULT,s)];D.createDescriptors({get:g(l.bind(null,n)),set:h.bind(null,n),apply:T.bind(null,n),deleteProperty:v.bind(null,n)},null,c);var o=t.create(c,!0,new r,null),i=A.set(e||"string"==typeof e?e:"/");return o.parse(i.toJSON())}var m=t.ResourcePool,j=t.CommandDescriptor,D=t.ProxyCommands,b=t.RequestTarget;m.setValidTargets(m.getDefaultValidTargets().concat(["string"]));var A=m.create(),O=Object.freeze({CREATE:"create",READ:"read",UPDATE:"update",DELETE:"delete",ROUTE:"route",PREVENT_DEFAULT:"preventDefault"}),P=Object.freeze({create:"PUT",read:"GET",update:"POST","delete":"DELETE"}),y=function(){function e(e){return"?"+Object.keys(e).reduce(function(t,n){return t.push(n+"="+encodeURIComponent(e[n])),t},[]).join("&")}function t(t,r,c,o){n||(n=new Headers,n.append("Content-Type","application/json; charset=utf-8"));var i={method:RESTObject.HTTPMethods[t]};t===O.READ?r+=c?e(c):"":(i.headers=n,i.body=JSON.stringify(c)),fetch(r,i).then(function(e){o.resolve(e.json())},function(e){o.reject(e)})}var n;return t}();return RESTObject=Object.freeze({create:p,JQUERY:R,FETCH:y,Commands:O,HTTPMethods:P,DataAccessInterface:t,RequestTarget:t.RequestTarget}),RESTObject});