!function(e,t){"function"==typeof define&&define.amd?define(["event-dispatcher","deferred-data-access"],t):"object"==typeof module&&module.exports?module.exports=t(require("event-dispatcher"),require("deferred-data-access")):e.RESTObject=t(e.EventDispatcher,e.DataAccessInterface)}(this,function(e,t){function n(){this.id="Fake/ResourcePool",this.set=function(e){return e},this.has=function(){return!1},this.get=function(e){return e},this.remove=function(){},this.clear=function(){},this.isActive=function(){return!0},this.destroy=function(){},this.addEventListener=function(){},this.hasEventListener=function(){},this.removeEventListener=function(){}}function r(){var e=new n;this.createPool=function(){return e},this.register=function(){},this.get=function(t){return e.id===t?e:null},this.isRegistered=function(t){return t instanceof b?e===t:e.id===t},this.remove=function(){},this.addEventListener=function(){},this.hasEventListener=function(){},this.removeEventListener=function(){}}function c(e,t){var n="",r=e.match(/([^\/\\]+)(?:\/|\\)*/g)||[];if("/"===t.charAt())n+=t;else if("../"===t.substr(0,3)){for(var c=t.match(/([^\/\\]+)(?:\/|\\)+/g);c.length&&r.length&&"../"===c[0];)c.shift(),r.pop();t=c.join("")+t.match(/[^\/\\]*$/g)[0],n+="/"+r.join("")}else"./"===t.substr(0,2)?(t=t.substring(2),n+="/"+r.join("")):n+="/"+r.join("");return n+"/"+t}function i(e,n){var r=O.get(t.getResourceId(e)),i=r.resource;return c(i,n)}function u(e,t){return O.set(i(e,t)).toJSON()}function o(e,t,n){n.resolve(u(e,t.cmd))}function s(e,t,n){n.resolve(p.toJSON(e))}function a(e,n,r,c){var i=O.get(t.getResourceId(n)),u=i.resource;e("CREATE",u,r.value,c)}function f(e,n,r,c){var i=O.get(t.getResourceId(n)),u=i.resource;e("READ",u,r.value,c)}function E(e,n,r,c){var i=O.get(t.getResourceId(n)),u=i.resource;e("UPDATE",u,r.value,c)}function d(e,n,r,c){var i=O.get(t.getResourceId(n)),u=i.resource;e("DELETE",u,r.value,c)}function l(e,t,n,r,c){if(p.getQueueLength(c))o(t,n,r);else{var u=i(t,n.cmd);e("READ",u,n.value,r)}}function v(e,t,n,r){var c=i(t,n.cmd);e("UPDATE",c,n.value,r)}function h(e,n,r,c){var i=O.get(t.getResourceId(n)),u=i.resource;1===r.value.length&&e("CREATE",u,r.value[0],c)}function T(e,t,n,r){var c=i(t,n.cmd);e("DELETE",c,n.value,r)}function g(e){function t(t,n,r,c){setTimeout(e,0,t,n,r,c)}return t}function R(e,t,n,r){jQuery.ajax({method:RESTObject.Methods[e],url:t,data:n,dataType:"json",success:function(e){r.resolve(e)},error:function(e){r.reject(e)}})}function D(e,t,n,r){fetch(t,{method:RESTObject.Methods[e],body:JSON.stringify(n)}).then(function(e){r.resolve(e.json())},function(e){r.reject(e)})}function m(e,n){n=n||RESTObject.FETCH;var c=[A.create(L.CREATE,a.bind(null,n)),A.create(L.READ,f.bind(null,n)),A.create(L.UPDATE,E.bind(null,n)),A.create(L.DELETE,d.bind(null,n)),A.create(L.ROUTE,o),A.create(L.PREVENT_DEFAULT,s)];j.createDescriptors({get:g(l.bind(null,n)),set:v.bind(null,n),apply:h.bind(null,n),deleteProperty:T.bind(null,n)},null,c);var i=t.create(c,!0,new r,null),u=O.set(e||"string"==typeof e?e:"/");return i.parse(u.toJSON())}var b=t.ResourcePool,A=t.CommandDescriptor,j=t.ProxyCommands,p=t.RequestTarget;b.setValidTargets(b.getDefaultValidTargets().concat(["string"]));var O=b.create(),L=Object.freeze({CREATE:"create",READ:"read",UPDATE:"update",DELETE:"delete",ROUTE:"route",PREVENT_DEFAULT:"preventDefault"}),P=Object.freeze({CREATE:"PUT",READ:"GET",UPDATE:"POST",DELETE:"DELETE"});return RESTObject=Object.freeze({create:m,JQUERY:R,FETCH:D,Commands:L,Methods:P,DataAccessInterface:t,RequestTarget:t.RequestTarget}),RESTObject});