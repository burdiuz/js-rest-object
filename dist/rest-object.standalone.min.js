!function(e,t){"function"==typeof define&&define.amd?define([],t):"object"==typeof module&&module.exports?module.exports=t():e.RESTObject=t()}(this,function(){function e(){this.id="Fake/ResourcePool",this.set=function(e){return e},this.has=function(){return!1},this.get=function(e){return e},this.remove=function(){},this.clear=function(){},this.isActive=function(){return!0},this.destroy=function(){},this.addEventListener=function(){},this.hasEventListener=function(){},this.removeEventListener=function(){}}function t(){var t=new e;this.createPool=function(){return t},this.register=function(){},this.get=function(e){return t.id===e?t:null},this.isRegistered=function(e){return e instanceof P?t===e:t.id===e},this.remove=function(){},this.addEventListener=function(){},this.hasEventListener=function(){},this.removeEventListener=function(){}}function r(e,t){var r="",n=e.match(/([^\/\\]+)(?:\/|\\)*/g)||[];if("/"===t.charAt())r+=t;else if("../"===t.substr(0,3)){for(var o=t.match(/([^\/\\]+)(?:\/|\\)+/g);o.length&&n.length&&"../"===o[0];)o.shift(),n.pop();t=o.join("")+t.match(/[^\/\\]*$/g)[0],r+="/"+n.join("")}else"./"===t.substr(0,2)?(t=t.substring(2),r+="/"+n.join("")):r+="/"+n.join("");return r+"/"+t}function n(e,t){var n=T.get(R.getResourceId(e)),o=n.resource;return r(o,t)}function o(e,t){return T.set(n(e,t)).toJSON()}function i(e,t,r){r.resolve(o(e,t.cmd))}function s(e,t,r){r.resolve(D.toJSON(e))}function u(e,t,r,n){var o=T.get(R.getResourceId(t)),i=o.resource;e(j.CREATE,i,r.cmd,r.value,n)}function c(e,t,r,n){var o=T.get(R.getResourceId(t)),i=o.resource;e(j.READ,i,r.cmd,r.value,n)}function a(e,t,r,n){var o=T.get(R.getResourceId(t)),i=o.resource;e(j.UPDATE,i,r.cmd,r.value,n)}function l(e,t,r,n){var o=T.get(R.getResourceId(t)),i=o.resource;e(j.DELETE,i,r.cmd,r.value,n)}function h(e,t,r,o,s){if(D.getQueueLength(s))i(t,r,o);else{var u=n(t,r.cmd);e(j.READ,u,r.value,null,o)}}function f(e,t,r,o){var i=n(t,r.cmd);e(j.UPDATE,i,r.value,null,o)}function p(e,t,r,n){var o=T.get(R.getResourceId(t)),i=o.resource,s=r.value.length;1===s&&e(j.CREATE,i,r.value[0],null,n)}function d(e,t,r,o){var i=n(t,r.cmd);e(j.DELETE,i,r.value,null,o)}function E(e){function t(t,r,n,o){setTimeout(e,0,t,r,n,o)}return t}function y(e,t,r,n,o){n&&(t+=(t.indexOf("?")<0?"?":"&")+jQuery.param(n)),jQuery.ajax({method:RESTObject.HTTPMethods[e],url:t,data:r?JSON.stringify(r):null,dataType:"json",contentType:"application/json; charset=utf-8",success:function(e){o.resolve(e)},error:function(e){o.reject(e)}})}function v(e,r,n){r=r||RESTObject.FETCH;var o=[m.create(j.CREATE,u.bind(null,r)),m.create(j.READ,c.bind(null,r)),m.create(j.UPDATE,a.bind(null,r)),m.create(j.DELETE,l.bind(null,r)),m.create(j.ROUTE,i),m.create(j.PREVENT_DEFAULT,s)];b.createDescriptors({get:E(h.bind(null,r)),set:f.bind(null,r),apply:p.bind(null,r),deleteProperty:d.bind(null,r)},null,o);var y=R.create(o,n!==!1,new t,null),v=T.set(e||"string"==typeof e?e:"/");return y.parse(v.toJSON())}function O(e){for(var t;t=D.getLastChild(e);)e=t;return e}var g=function(){var e=function(){function e(){return{type:this.type,data:this.data}}function t(e,t){function r(){return o}function n(){o=!0}var o=!1;Object.defineProperties(this,{type:{value:e,enumerable:!0},data:{value:t||null,enumerable:!0}}),this.preventDefault=n,this.isDefaultPrevented=r}return t.prototype.toJSON=e,t}(),t=function(){function e(e,t,r){var n=i(e,r,this._listeners);n.indexOf(t)<0&&n.push(t)}function t(e){var t=!1,r=s(e,this._listeners);if(r)for(var n in r)if(r.hasOwnProperty(n)){t=!0;break}return t}function r(e,t){var r=s(e,this._listeners);if(r)for(var n=Object.getOwnPropertyNames(r),o=n.length,i=0;o>i;i++){var u=n[i],c=r[u],a=c.indexOf(t);a>=0&&(c.splice(a,1),c.length||delete r[u])}}function n(e){delete this._listeners[e]}function o(e,t){function r(){o=!0}function n(){i=!0}var o=!1,i=!1;e.stopPropagation=r,e.stopImmediatePropagation=n;var u=s(e.type,this._listeners);if(u)for(var c=Object.getOwnPropertyNames(u).sort(function(e,t){return e-t}),a=c.length,l=0;a>l&&!o;l++)for(var h=u[c[l]],f=h.length,p=0;f>p&&!i;p++){var d=h[p];d.call(t,e)}delete e.stopPropagation,delete e.stopImmediatePropagation}function i(e,t,r){var n=s(e,r,Object);return s(parseInt(t),n,Array)}function s(e,t,r){var n=null;return t.hasOwnProperty(e)?n=t[e]:r&&(n=t[e]=new r),n}function u(){this._listeners={}}return u.prototype.add=e,u.prototype.has=t,u.prototype.remove=r,u.prototype.removeAll=n,u.prototype.call=o,u}(),r={},n=function(){function n(e){e!==r&&(Object.defineProperty(this,p,{value:new t}),Object.defineProperty(this,d,{value:e}))}function o(e,t,r){this[p].add(e,t,-r||0)}function i(e){return this[p].has(e)}function s(e,t){this[p].remove(e,t)}function u(e){this[p].removeAll(e)}function c(e,t){var r=n.getEvent(e,t);this[d]&&(r=this[d].call(this,r)),this[p].call(r)}function a(e){return"object"==typeof e&&null!==e}function l(e,t){var r=e;return n.isObject(e)||(r=new n.Event(String(e),t)),r}function h(e){return new n(e)}function f(){return new n(r)}var p=Symbol("event.dispatcher::listeners"),d=Symbol("event.dispatcher::preprocessor");return n.prototype.addEventListener=o,n.prototype.hasEventListener=i,n.prototype.removeEventListener=s,n.prototype.removeAllEventListeners=u,n.prototype.dispatchEvent=c,n.isObject=a,n.getEvent=l,n.create=h,n.createNoInitPrototype=f,n.Event=e,n}();return n}(),R=function(){var e=function(){"use strict";function e(){return new E}function t(){return"function"==typeof Proxy}function r(){}function n(e,t){t=t||b.defaultResourcePool;var n=null;return e instanceof P?n=e.toJSON():"object"==typeof e[f]?n=N.toJSON(e):e instanceof r||"function"==typeof e?n=t.set(e).toJSON():c(e)&&(n=e),n}function o(e){var t=n(e);return t?t[p]:null}function i(e){var t=null;return"object"==typeof e[f]?t=e[f].id:c(e)&&(t=e[p].id),t}function s(e){var t=null;return"object"==typeof e[f]?t=e[f].poolId:c(e)&&(t=e[p].poolId),t}function u(e){var t=null;return"object"==typeof e[f]?t=e[f].type:c(e)&&(t=e[p].type),t}function c(e){return e instanceof P||e instanceof N||e&&("object"==typeof e[f]||"object"==typeof e[p])}function a(e){return c(e)||"function"==typeof e||e instanceof r}function l(e,t){return function(r,n,o){var i=y.create(e,r,t,n);return o instanceof Array?o.push(i):o&&(o[t]=i),i}}var h=Object.freeze({PENDING:"pending",RESOLVED:"resolved",REJECTED:"rejected",DESTROYED:"destroyed"}),f=Symbol("request.target:internals"),p="resource::data",d=function(){var e="DA/"+String(Date.now())+"/",t=0;return function(){return e+String(++t)+"/"+String(Date.now())}}(),E=function(){function e(){this._status=h.PENDING,this.promise=new Promise(function(e,t){this._resolveHandler=e,this._rejectHandler=t}.bind(this)),Object.defineProperties(this,{status:{get:t}})}function t(){return this._status}function r(){var e=this._resolveHandler.apply(null,arguments);return this._status=h.RESOLVED,e}function n(){var e=this._rejectHandler.apply(null,arguments);return this._status=h.REJECTED,e}return e.prototype.resolve=r,e.prototype.reject=n,e}(),y=function(){function e(){return!1}function t(t,r,n,o,i){this.name=void 0!==n?n:t,this.type=t,this.handle=r,this.isTemporary=o||e,this.cacheable=Boolean(i)}function r(e,r,n,o,i){var s=new t(e,r,n,o,i);return Object.freeze(s)}return t.create=r,t}(),v=Object.freeze({DESTROY:"::destroy.resource"}),O=function(){function e(){return[u.GET,u.SET,u.APPLY,u.DELETE_PROPERTY]}function t(){return[u.GET,u.SET,u.APPLY]}function r(e,t,r){var n,o,i,s,u=O.list,c=u.length;r=r||{};for(var a=0;c>a;a++)o=u[a],n=e[o],i=O.fields[o],n instanceof Function&&(s=y.create(o,n,i,t),r instanceof Array?r.push(s):r&&(r[i]=s));return r}var n=Symbol("proxy.commands::get"),o=Symbol("proxy.commands::set"),i=Symbol("proxy.commands::apply"),s=Symbol("proxy.commands::deleteProperty"),u={GET:"get",SET:"set",APPLY:"apply",DELETE_PROPERTY:"deleteProperty"};return u.fields=Object.freeze({get:n,set:o,apply:i,deleteProperty:s}),Object.defineProperties(u,{list:{get:e},required:{get:t}}),u.createGETDescriptor=l(u.GET,u.fields.get),u.createSETDescriptor=l(u.SET,u.fields.set),u.createAPPLYDescriptor=l(u.APPLY,u.fields.apply),u.createDescriptors=r,Object.freeze(u)}(),R=Object.freeze({names:Object.freeze({then:!0,"catch":!0}),commands:Object.freeze({"::destroy.resource":!0})}),P=function(){function e(e,u,c,a){Object.defineProperty(this,f,{value:{active:!0,pool:e,poolId:e?e.id:null,resource:u,type:c,id:a}}),Object.defineProperty(this,p,{get:t}),Object.defineProperties(this,{active:{get:r},poolId:{get:n},resource:{get:o},type:{get:i},id:{get:s}})}function t(){return this.toJSON()}function r(){return Boolean(this[f].active)}function n(){return this[f].poolId}function o(){return this[f].resource}function i(){return this[f].type||typeof this[f].resource}function s(){return this[f].id}function u(){var e={};return e[p]={id:this[f].id,type:this.type,poolId:this.poolId},e}function c(){var e=this[f].id,t=this[f].pool;if(this[f].active){this[f].active=!1,t.remove(e);for(var r in this[f])delete this[f][r]}}function a(t,r,n,o){return new e(t,r,n,o||d())}return e.prototype.toJSON=u,e.prototype.destroy=c,e.create=a,e}(),m=function(){function e(){this[E]=new Map,Object.defineProperties(this,{id:{value:d()}}),g.apply(this)}function t(t,r){var n=null;return e.isValidTarget(t)&&(this[E].has(t)?n=this[E].get(t):(n=P.create(this,t,r||typeof t),this[E].set(n.id,n),this[E].set(t,n),this.hasEventListener(p.RESOURCE_ADDED)&&this.dispatchEvent(p.RESOURCE_ADDED,n))),n}function r(e){return this[E].has(e)}function n(e){return this[E].get(e)}function o(e){var t=this[E].get(e);t&&(this[E]["delete"](t.id),this[E]["delete"](t.resource),this.hasEventListener(p.RESOURCE_REMOVED)&&this.dispatchEvent(p.RESOURCE_REMOVED,t),t.destroy())}function i(){this.hasEventListener(p.POOL_CLEAR)&&this.dispatchEvent(p.POOL_CLEAR,this);for(var e,t=this[E].keys();!(e=t.next()).done;)if("string"==typeof e.value){var r=this[E].get(e.value);r.destroy()}this[E].clear(),this.hasEventListener(p.POOL_CLEARED)&&this.dispatchEvent(p.POOL_CLEARED,this)}function s(){return Boolean(this[E])}function u(){this.clear(),delete this[E],this.hasEventListener(p.POOL_DESTROYED)&&this.dispatchEvent(p.POOL_DESTROYED,this)}function a(e){return!c(e)&&Boolean(y[typeof e])}function l(e){y={};for(var t=e.length,r=0;t>r;r++)y[e[r]]=!0}function h(){return["object","function"]}function f(){return new e}var p=Object.freeze({RESOURCE_ADDED:"resourceAdded",RESOURCE_REMOVED:"resourceRemoved",POOL_CLEAR:"poolClear",POOL_CLEARED:"poolCleared",POOL_DESTROYED:"poolDestroyed"}),E=Symbol("ResourcePool::map"),y={};return e.prototype=g.createNoInitPrototype(),e.prototype.constructor=e,e.prototype.set=t,e.prototype.has=r,e.prototype.get=n,e.prototype.remove=o,e.prototype.clear=i,e.prototype.isActive=s,e.prototype.destroy=u,e.isValidTarget=a,e.setValidTargets=l,e.getDefaultValidTargets=h,e.create=f,e.Events=p,e.setValidTargets(e.getDefaultValidTargets()),e}(),b=function(){function e(e){this.remove(e.data)}function t(){m.apply(this),this.destroy=function(){throw new Error("Default ResourcePool cannot be destroyed.")}}function r(){Object.defineProperty(this,l,{value:{}}),g.apply(this),this._poolDestroyedListener=e.bind(this),this.register(r.defaultResourcePool)}function n(){var e=m.create();return this.hasEventListener(a.RESOURCE_POOL_CREATED)&&this.dispatchEvent(a.RESOURCE_POOL_CREATED,e),this.register(e),e}function o(e){this[l].hasOwnProperty(e.id)||(this[l][e.id]=e,e.addEventListener(m.Events.POOL_DESTROYED,this._poolDestroyedListener),this.hasEventListener(a.RESOURCE_POOL_REGISTERED)&&this.dispatchEvent(a.RESOURCE_POOL_REGISTERED,e))}function i(e){return this[l][e]||null}function s(e){return this[l].hasOwnProperty(e instanceof m?e.id:String(e))}function u(e){var t=!1;return e=e instanceof m?e:this.get(e),e&&(e.removeEventListener(m.Events.POOL_DESTROYED,this._poolDestroyedListener),t=delete this[l][e.id]),this.hasEventListener(a.RESOURCE_POOL_REMOVED)&&this.dispatchEvent(a.RESOURCE_POOL_REMOVED,e),t}function c(){return new r}var a=Object.freeze({RESOURCE_POOL_CREATED:"resourcePoolCreated",RESOURCE_POOL_REGISTERED:"resourcePoolRegistered",RESOURCE_POOL_REMOVED:"resourcePoolRemoved"}),l=Symbol("resource.pool.registry::pools");return t.prototype=m.prototype,r.prototype=g.createNoInitPrototype(),r.prototype.constructor=r,r.prototype.createPool=n,r.prototype.register=o,r.prototype.get=i,r.prototype.isRegistered=s,r.prototype.remove=u,r.create=c,r.Events=a,r.defaultResourcePool=new t,r}(),D=function(){function e(e,t,r,n){this[d]=e,this[y]=r,this[E]=t,g.apply(this),n&&n.setConverter(this)}function t(e){var t;return t=a(e)?n(e,this[y]):"function"==typeof e.toJSON?e.toJSON():e,t!==e&&this.hasEventListener(v.RESOURCE_CONVERTED)&&this.dispatchEvent(v.RESOURCE_CONVERTED,{data:e,result:t}),t}function r(e){var t,r=e;if(c(e))if(t=s(e),this[E].isRegistered(t)){var n=this[E].get(t).get(i(e));n&&(r=n.resource)}else r=this[d].create(Promise.resolve(e));return r!==e&&this.hasEventListener(v.RESOURCE_CREATED)&&this.dispatchEvent(v.RESOURCE_CREATED,{data:e,result:r}),r}function o(e,t){for(var r=[],n=e.length,o=0;n>o;o++)r[o]=t.call(this,e[o]);return r}function u(e,t){var r={};for(var n in e)e.hasOwnProperty(n)&&(r[n]=t.call(this,e[n]));return r}function l(e){var t=e;return void 0!==e&&null!==e&&(a(e)?t=this.resourceToObject(e):e instanceof Array?t=this.lookupArray(e,this.resourceToObject):e.constructor===Object&&(t=this.lookupObject(e,this.resourceToObject))),t}function h(e){var t=e;return void 0!==e&&null!==e&&(c(e)?t=this.objectToResource(e):e instanceof Array?t=this.lookupArray(e,this.objectToResource):e.constructor===Object&&(t=this.lookupObject(e,this.objectToResource))),t}function f(e){function t(e){return N.isPending(e)&&r.push(e),e}var r=[];return"object"==typeof e&&null!==e&&(N.isPending(e)?r.push(e):e instanceof Array?this.lookupArray(e,t):e.constructor===Object&&this.lookupObject(e,t)),r}function p(t,r,n,o){return new e(t,r,n,o)}var d=Symbol("resource.converter::factory"),E=Symbol("resource.converter::resourcePoolRegistry"),y=Symbol("resource.converter::resourcePool"),v=Object.freeze({RESOURCE_CREATED:"resourceCreated",RESOURCE_CONVERTED:"resourceConverted"});return e.prototype=g.createNoInitPrototype(),e.prototype.constructor=e,e.prototype.toJSON=l,e.prototype.parse=h,e.prototype.lookupArray=o,e.prototype.lookupObject=u,e.prototype.lookupForPending=f,e.prototype.resourceToObject=t,e.prototype.objectToResource=r,e.create=p,e.Events=v,e}(),T=function(){function e(r){function n(e){h=e}function o(t){p={},e.filterHandlers(t,p),f=Object.getOwnPropertyNames(p).concat(Object.getOwnPropertySymbols(p)),r&&e.areProxyHandlersAvailable(p,!0)}function i(e){return p.hasOwnProperty(e)}function s(){return p}function u(){return f.slice()}function c(e){return p[e]||null}function a(e,t,r,n,o){var i=h?h.lookupForPending(r.value):null;i&&i.length?Promise.all(i).then(function(){l(e,t,r,n,o)}):l(e,t,r,n,o)}function l(e,t,r,n,o){var i=c(t);if(!(i instanceof y))throw new Error('Command descriptor for "'+t+'" was not found.');i.handle(e,r,n,o)}var h,f=[],p={};r=Boolean(r),Object.defineProperties(this,{proxyEnabled:{value:r},available:{get:function(){return Boolean(f.length)}}}),this.setConverter=n,this.setHandlers=o,this.hasHandler=i,this.getHandlers=s,this.getHandlerNames=u,this.getHandler=c,this.handle=a,this[Symbol.iterator]=function(){return new t(this.getHandlers(),this.getHandlerNames())}}function t(e,t){function r(){var r;return r=++o>=n?{done:!0}:{value:e[t[o]],done:!1}}var n=t.length,o=-1;this.next=r,this[Symbol.iterator]=function(){return this}.bind(this)}function r(t){return new e(t)}function n(e,t){for(var r=!0,n=O.required,o=n.length,i=0;o>i;i++){var s=n[i];if(!(O.fields[s]in e)&&(r=!1,t))throw new Error('For Proxy interface, handler "'+s+'" should be set.')}return r}var o=Object.freeze({HANDLERS_UPDATED:"handlersUpdated"}),i=function(){function e(e,t){for(var n=e.length,o=0;n>o;o++){var i=e[o];i instanceof y&&r(i,t)}}function t(e,t){if(e)for(var n=Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e)),o=n.length,i=0;o>i;i++){var s=n[i],u=e[s];"function"==typeof u&&(u=y.create(s,u)),u instanceof y&&r(u,t)}}function r(e,t){var r=e.name,n=e.type;if(n in R.commands)throw new Error('Command "'+n+'" is reserved and cannot be used in descriptor.');if(r in R.names)throw new Error('Name "'+r+'" is reserved and cannot be used in descriptor.');if(t.hasOwnProperty(r)&&t[r]instanceof y)throw new Error('Field names should be unique, "'+String(r)+'" field has duplicates.');t[r]=e}function n(r,n){r instanceof Array?e(r,n):t(r,n)}return n}();return e.filterHandlers=i,e.areProxyHandlersAvailable=n,e.create=r,e.Events=o,e}(),j=function(){function t(){function t(e){var t=e.name;return c.has(t)||c.set(t,r(e.name,e.type,e.isTemporary,e.cacheable)),c.get(t)}function r(e,t,r,i){function s(s,c){var a,l;if(this[f]){var h=A.createRequestPackage(t,s,c,this[f].id),p=n(e,h,i);a=p.child,p.deferred&&(l=this[f].sendRequest(e,h,p.deferred,a),l||(a=null),l=o(l,r,this,a,h))}else l=Promise.reject(new Error("Target object is not a resource, so cannot be used for calls."));return a||u.create(l)}return s}function n(t,r,n){var o,i;return n&&(o=u.getCached(t,r)),o||(i=e(),o=n?u.createCached(i.promise,t,r):u.create(i.promise,t,r)),{child:o,deferred:i}}function o(e,t,r,n,o){return e?e.then(function(e){N.setTemporary(n,Boolean(t(r,n,o,e)))}):e=Promise.reject(new Error("Initial request failed and didn't result in promise.")),e}function i(e){u=e}function s(){return u}var u,c=new Map;this.get=t,this.setFactory=i,this.getFactory=s}return t}(),S=function(){function e(e,t){function r(e){if(t.available){for(var r,n=t[Symbol.iterator]();!(r=n.next()).done;){var o=r.value;e[o.name]=i.get(o)}return e}}function n(e){e&&i.setFactory(e)}function o(){return i.getFactory()}var i=new j;i.setFactory(e),this.apply=r,this.setFactory=n,this.getFactory=o}function t(t,r){return new e(t,r)}return e.create=t,e}(),C=Symbol("request.factory::decorator"),_=Symbol("request.factory::handlers"),L=function(){function e(e,t){e!==s&&(this[_]=e,this[C]=S.create(this,e),Object.defineProperties(this,{cache:{value:t||null}}))}function t(e){var t=N.create(e,this[_]);return this[_].available&&this[C].apply(t),t}function r(e,t){return this.cache&&this.cache.get(e,t)}function n(e,t,r){var n=null;return this.cache&&(n=this.create(e),this.cache.set(t,r,n)),n}function o(t,r){return new e(t,r)}function i(){return new e(s)}var s={};return e.prototype.create=t,e.prototype.getCached=r,e.prototype.createCached=n,e.create=o,e.createNoInitProtoype=i,e}(),w=function(){function e(e,t){function r(){}return r.target=e,new Proxy(r,t)}function t(e,t,r){var n,o=e.target;return n=t in o||t in E||"symbol"==typeof t?o[t]=r:o[O.fields.set](t,r)}function r(e,t){return e.target.hasOwnProperty(t)}function n(e,t){var r=!1,n=e.target;return O.fields.deleteProperty in n&&(n[O.fields.deleteProperty](t),r=!0),r}function o(){return Object.getOwnPropertyNames(E)}function i(){return Object.getOwnPropertyNames(E)[Symbol.iterator]()}function s(e,t){var r;return r=E.hasOwnProperty(t)?Object.getOwnPropertyDescriptor(e,t):Object.getOwnPropertyDescriptor(e.target,t)}function u(){function e(e,t){var r,n=e.target;return r=t in n||t in E||"symbol"==typeof t?n[t]:n[O.fields.get](t)}function u(e,t,r){return e.target[O.fields.apply](null,r)}var c;return c={get:e,apply:u,set:t,has:r,deleteProperty:n,ownKeys:o,enumerate:i,getOwnPropertyDescriptor:s}}function c(e,t){this[_]=e,this[d]=L.create(e,t),this[d][C].setFactory(this)}function a(t){var r=this[d].create(t);return this[_].available&&(r=e(r,y)),r}function l(e,t){return this[d].getCached(e,t)}function h(t,r,n){var o=this[d].createCached(t,r,n);return this[_].available&&(o=e(o,y)),o}function f(t){return e(t,y)}function p(e,t){return new c(e,t)}var d=Symbol("request.proxy.factory::factory"),E={arguments:!0,caller:!0,prototype:!0},y=u();return c.prototype=L.createNoInitProtoype(),c.prototype.constructor=c,c.prototype.create=a,c.prototype.getCached=l,c.prototype.createCached=h,c.create=p,c.applyProxy=f,c}(),A=function(){function t(t,o,c){this.requestHandlers=c,this.requestTarget=t,this.link={},this.temporary,this.hadChildPromises=!1,this.status=h.PENDING,this.queue=[],this.children=[],this._deferred=e(),this.promise=this._deferred.promise,Object.defineProperties(this,{poolId:{get:r},type:{get:n},id:{get:i}}),o.then(s.bind(this),u.bind(this))}function r(){return this.link.poolId||null}function n(){return this.link.type||null}function i(){return this.link.id||null}function s(e){this.status=h.RESOLVED,c(e)?(this.link=o(e),e={target:this.requestTarget},this._sendQueue(),this.temporary&&this.destroy()):this._rejectQueue("Target of the call is not a resource and call cannot be sent."),this._deferred.resolve(e),delete this._deferred}function u(e){this.status=h.REJECTED,this._rejectQueue("Target of the call was rejected and call cannot be sent."),this._deferred.reject(e),delete this._deferred}function a(){for(;this.queue&&this.queue.length;){var e=this.queue.shift(),t=e[0],r=e[1],n=e[2],o=e[3];r.target=this.link.id,this._handleRequest(t,r,n,o)}this.queue=null}function l(e){for(var t=new Error(e||"This request was rejected before sending.");this.queue&&this.queue.length;){var r=this.queue.shift();r[2].reject(t)}this.queue=null}function f(t,r,n,o){var i=null;if(!this.requestHandlers.hasHandler(t))throw new Error('Request handler for "'+t+'" is not registered.');return i=this._applyRequest(t,r,n||e(),o),o&&this.registerChild(o),i}function d(e,t,r,n){this.queue.push([e,t,r,n])}function E(e,t,r,n){var o=r.promise;switch(this.status){case h.PENDING:this._addToQueue(e,t,r,n);break;case h.REJECTED:o=Promise.reject(new Error("Target object was rejected and cannot be used for calls."));break;case h.DESTROYED:o=Promise.reject(new Error("Target object was destroyed and cannot be used for calls."));break;case h.RESOLVED:this._handleRequest(e,t,r,n)}return o}function y(e,t,r,n){this.requestHandlers.handle(this.requestTarget,e,t,r,n)}function O(e){var t=g.bind(this,e),r=N.getRawPromise(e);this.children.push(e),r.then(t,t)}function g(e){if(this.children){var t=this.children.indexOf(e);t>=0&&this.children.splice(t,1)}}function R(){return this.status===h.PENDING||this.status===h.RESOLVED}function P(){return this.status===h.RESOLVED||this.status===h.REJECTED}function m(){var e=null;return this.canBeDestroyed()?(e=this.status===h.RESOLVED?this.sendRequest(v.DESTROY,t.createRequestPackage(v.DESTROY,null,null,this.id)):Promise.resolve(),this.status=h.DESTROYED):e=Promise.reject(new Error("Invalid or already destroyed target.")),e}function b(){var e=this.promise.then.apply(this.promise,arguments);return e&&(this.hadChildPromises=!0),e}function D(){var e=this.promise["catch"].apply(this.promise,arguments);return e&&(this.hadChildPromises=!0),e}function T(){var e={};return e[p]={id:this.link.id,type:this.link.type,poolId:this.link.poolId},e}function j(e,t,r,n){return{type:e,cmd:t,value:r,target:n}}return t.prototype._sendQueue=a,t.prototype._rejectQueue=l,t.prototype.sendRequest=f,t.prototype._addToQueue=d,t.prototype._applyRequest=E,t.prototype._handleRequest=y,t.prototype.registerChild=O,t.prototype.isActive=R,t.prototype.canBeDestroyed=P,t.prototype.destroy=m,t.prototype.then=b,t.prototype["catch"]=D,t.prototype.toJSON=T,t.createRequestPackage=j,t}(),N=function(){function e(e,r){var n;Object.defineProperty(this,f,{value:new A(this,e,r),configurable:!0}),n=t.bind(this,e),e.then(n,n)}function t(e,t){c(t)||(this[b]=e,delete this[f])}function r(){var e=this[f]||this[b];e.then.apply(e,arguments)}function n(){var e=this[f]||this[b];e["catch"].apply(e,arguments)}function o(e){return e&&e[f]?e[f].isActive():!1}function i(e){return e&&e[f]?e[f].canBeDestroyed():!1}function s(e){return e&&e[f]?e[f].destroy():null}function u(e){return e&&e[f]?e[f].toJSON():null}function a(e){return d(e)==h.PENDING}function l(e){return e&&e[f]&&e[f].temporary}function p(e,t){e&&e[f]&&(e[f].temporary=Boolean(t))}function d(e){return e&&e[f]?e[f].status:null}function E(e){var t=e&&e[f]?e[f].queue:null;return t?t.length:0}function y(e){var t,r=[],n=e&&e[f]?e[f].queue:null;if(n){t=n.length;for(var o=0;t>o;o++)r.push(n[o][0].type)}return r}function v(e){return Boolean(e&&e[f]&&e[f].hadChildPromises)}function O(e){return e&&e[f]?e[f].promise:null}function g(e){var t=e&&e[f]?e[f].children:null;return t?t.slice():[]}function R(e){var t=e&&e[f]?e[f].children:null;return t&&t.length?t[t.length-1]:null}function P(e){var t=e&&e[f]?e[f].children:null;return t?t.length:0}function m(t,r){return new e(t,r)}var b=Symbol("request.target::promise");return e.prototype.then=r,e.prototype["catch"]=n,e.isActive=o,e.canBeDestroyed=i,e.destroy=s,e.toJSON=u,e.isPending=a,e.isTemporary=l,e.setTemporary=p,e.getStatus=d,e.getQueueLength=E,e.getQueueCommands=y,e.hadChildPromises=v,e.getRawPromise=O,e.getChildren=g,e.getLastChild=R,e.getChildrenCount=P,e.create=m,e}(),q=function(){function l(e,r,n,o,i){function s(){o.removeEventListener(m.Events.POOL_DESTROYED,s),o=n.createPool(),o.addEventListener(m.Events.POOL_DESTROYED,s)}if(r=Boolean(r),r&&!t())throw new Error("Proxies are not available in this environment");var u=T.create(r),c=(r?w:L).create(u,i);n=n||b.create(),o?n.register(o):o=void 0!==o?n.createPool():b.defaultResourcePool,Object.defineProperties(this,{poolRegistry:{value:n},pool:{get:function(){return o}},resourceConverter:{value:D.create(c,n,o,u)},factory:{value:c},proxyEnabled:{get:function(){return u.proxyEnabled}}}),u.setHandlers(e),o.addEventListener(m.Events.POOL_DESTROYED,s)}function h(e){return this.resourceConverter.parse(e)}function f(e){return this.resourceConverter.toJSON(e)}function p(e,t,r,n,o){return new l(e,t,r,n,o)}return l.prototype.parse=h,l.prototype.toJSON=f,l.create=p,l.createDeferred=e,l.IConvertible=r,l.RequestTarget=N,l.Deferred=E,l.Reserved=R,l.RequestTargetCommands=v,l.CommandDescriptor=y,l.ProxyCommands=O,l.ResourcePool=m,l.ResourcePoolRegistry=b,l.ResourceConverter=D,l.getRAWResource=n,l.getResourceData=o,l.getResourceId=i,l.getResourcePoolId=s,l.getResourceType=u,l.isResource=c,l.isResourceConvertible=a,l}();return q}();return e}(),P=R.ResourcePool,m=R.CommandDescriptor,b=R.ProxyCommands,D=R.RequestTarget;P.setValidTargets(P.getDefaultValidTargets().concat(["string"]));var T=P.create(),j=Object.freeze({CREATE:"create",READ:"read",UPDATE:"update",DELETE:"delete",ROUTE:"route",PREVENT_DEFAULT:"preventDefault"}),S=Object.freeze({create:"PUT",read:"GET",update:"POST","delete":"DELETE"}),C=function(){function e(e,t){return e+(e.indexOf("?")<0?"?":"&")+Object.keys(t).reduce(function(e,r){return e.push(encodeURIComponent(r)+"="+encodeURIComponent(t[r])),e},[]).join("&")}function t(t,n,o,i,s){r||(r=new Headers,r.append("Content-Type","application/json; charset=utf-8"));var u={method:RESTObject.HTTPMethods[t]};i&&(n=e(n,i)),o&&(u.headers=r,u.body=JSON.stringify(o)),fetch(n,u).then(function(e){s.resolve(e.json())},function(e){s.reject(e)})}var r;return t}();return RESTObject=Object.freeze({create:v,JQUERY:y,FETCH:C,Commands:j,HTTPMethods:S,DataAccessInterface:R,RequestTarget:D,getDeepestChild:O}),RESTObject});